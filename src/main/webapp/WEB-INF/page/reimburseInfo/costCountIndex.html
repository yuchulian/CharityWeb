#@layout()
#define main()
<div class="row">
	<div class="panel-body">
		<div class="form-inline">
			<div>
				<label class="label-control">报销时间:</label>
				<input class="form-control w100" id="startTime" type="text" name="startTime"/>
				<label class="label-control">-</label>
				<input class="form-control w100" id="endTime" type="text" name="endTime"/>
				<input class="btn btn-primary " type="button" value="搜索" id="costCountSearch" />
				<input class="btn btn-primary " type="button" value="重置" id="costCountReset" />
			</div>
		</div>
	</div>		
	<div class="col-md-12">
		<div class="panel panel-visible">
		
			<!-- <div class="panel-heading">
				<ol class="breadcrumb" id="projectInfo_menu"> </ol>
			</div> -->
			
			<div class="panel-body pn">
				<div id="datatable2_wrapper" class="dataTables_wrapper form-inline dt-bootstrap no-footer">
					<table class="table  table-hover dataTable no-footer" id="costCountTable">
						<thead>
							<tr>
								<th class="sorting_asc">部门</th>
								<th class="sorting_disabled">用户姓名</th>
								<th class="sorting_disabled">报销总金额</th>
							</tr>
						</thead>
						<tbody> </tbody>
					</table>
				</div>
			</div>
			
		</div>
	</div>
</div>

<script type="text/javascript">
util.initDateRange('#startTime', '#endTime');
util.initPage("/reimburseInfoData/costCount", {
	search : {
		bind : {
			searchId : '#costCountSearch',
			resetId : '#costCountReset'
		},
		column : {
			'reimburse_time' : ['betweenDate' , '#startTime,#endTime']
		}
	}
	}, function(data) {
	var tableHTML = [],
		obj = {},
		costCountList = data.list,
		costMap = {};
	for (var i = 0; i < costCountList.length; i++) {
		obj = costCountList[i];
		if(costMap[obj.project_department_name]){
			costMap[obj.project_department_name].push(obj);
		}else{
			costMap[obj.project_department_name] = [obj];
			
		}
	}
	for(var cost in costMap){
		var costvalue = costMap[cost];
		tableHTML.push('<tr>');
		tableHTML.push('<td rowspan = "',(costvalue.length+1),'">');
		tableHTML.push(cost);
		tableHTML.push('</td>');
		tableHTML.push('</tr>');
		for(var i = 0;i< costvalue.length;i++){
			obj = costvalue[i];
			tableHTML.push('<tr>');
			tableHTML.push('<td>');
			tableHTML.push(obj.employ_name);
			tableHTML.push('</td>');
			tableHTML.push('<td>');
			tableHTML.push(obj.cost_count);
			tableHTML.push('</td>');
			tableHTML.push('</tr>');
		}
	}
	$("#costCountTable tbody").html(tableHTML.join(""));
});
</script>
#end