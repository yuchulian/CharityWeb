#@layout()
#define main()

<div class="row">
	<div class="col-md-12">
		<div class="panel panel-visible">
		
			<div class="panel-heading">
				<ol class="breadcrumb" id="employInfo_menu"> </ol>
			</div>
			<div class="panel-body pn">
				<div id="datatable2_wrapper" class="dataTables_wrapper form-inline dt-bootstrap no-footer">
					<div class="dt-panelmenu clearfix">
						<input type="hidden" id="powerPidSearch" value="0"/>
						<button type="button" class="btn btn-primary btn-gradient dark" id="employInfoAdd">员工添加</button>
					</div>
					<table class="table table-striped table-hover dataTable no-footer" id="employInfoTable">
						<thead>
							<tr>
								<th>&nbsp;</th>
								<th class="sorting_asc">员工姓名</th>
								<th class="sorting_disabled">员工性别</th>
								<th class="sorting">员工联系方式</th>
								<th class="sorting_disabled">操作</th>
							</tr>
						</thead>
						<tbody> </tbody>
					</table>
					<div class="dt-panelfooter clearfix">
						<div class="dataTables_info" id="datatable2_info" role="status"
							aria-live="polite">Showing 1 to 5 of 13 entries</div>
						<div class="dataTables_paginate paging_simple_numbers"
							id="employInfo">
							<ul class="pagination">
								<li class="paginate_button active" aria-controls="datatable2"
									tabindex="0"><a href="#">1</a></li>
								<li class="paginate_button " aria-controls="datatable2" tabindex="0"><a
									href="#">2</a></li>
								<li class="paginate_button " aria-controls="datatable2" tabindex="0"><a
									href="#">3</a></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
			
		</div>
	</div>
</div>

<script type="text/javascript">
	util.initPage("/employInfoData/employInfoPaginate", {
		paginate:{
			paginateId:"#employInfo",
			pageNumber:1,
			pageSize:10
		},
		sort : {
			"id" : "asc"
		},
		search : {
			column : {
// 				"power_pid" : [ "=", "#powerPidSearch", "0" ]
			}
		},
		modal : {
			"employInfoUpdate" : {
				bind : {
					"#employInfoAdd" : {
						title : "员工添加"
					}
				},
				pageUrl : "/employInfoPage/employInfoEdit",
				title : "员工修改",
				width : 1100,
				button : {
					"submit" : {
						name : "确定",
						className : "btn-primary",
						click : function(dataMap) {
// 							if ($('#employInfoForm').validationEngine('validate')) {
								var employInfo = util.getModal(dataMap),$this="";
								$("#employInfo_id td[id]").each(function() {
									$this = $(this);
									console.log($this.text());
									employInfo["employInfo."+$this.attr("id")] = $.trim($this.text());
								});
								employInfo["employInfo.employ_img"] = $.trim($("#employInfoImg").attr("_src"));
								util.call("/employInfoData/employInfoSave", employInfo, function(returnMsg) {
									util.refreshPage(dataMap);
									util.closeModal(dataMap);
									util.alert(returnMsg["returnMsg"]);
								});
// 							}
						}
					}
				}
			},
			"employInfoDelete" : {
				button : {
					"submit" : {
						name : "确定",
						className : "btn-primary",
						click : function(dataMap) {
							util.call("/employInfoData/employInfoDelete", { "id" : dataMap["id"] + "" }, function(returnMsg) {
								util.refreshPage(dataMap);
								util.closeModal(dataMap);
								util.alert(returnMsg["returnMsg"]);
							});
						}
					}
				}
			},
			/* "employOpenAccount" : {
				button : {
					"submit" : {
						name : "确定",
						className : "btn-primary",
						click : function(dataMap) {
							util.call("/employInfoData/employOpenAccount", { "id" : dataMap["id"] + "" }, function(returnMsg) {
								util.refreshPage(dataMap);
								util.closeModal(dataMap);
								util.alert(returnMsg["returnMsg"]);
							});
						}
					}
				}
			}, */
			"employEditAccount" : {
				pageUrl : "/employInfoPage/employViewEdit",
				width : 794,
				button : {
					"submit" : {
						name : "确定",
						className : "btn-primary",
						click : function(dataMap) {
							if ($('#employViewForm').validationEngine('validate')) {
								var loginInfo = util.getModal(dataMap);
								
								//角色
								var treeObj = $.fn.zTree.getZTreeObj("roleInfoTree");
								var nodeList = treeObj.getCheckedNodes(true), idList = [], nodeObj = {};
								for(var i=0; i<nodeList.length; i++) {
									nodeObj = nodeList[i];
									idList.push(nodeObj.id);
								}
								loginInfo["loginInfo.role_id"] = ","+idList.join(",")+",";
								if(!idList.length) {
									util.alert("最少勾选一个角色");
									return;
								}
								
								//部门
								treeObj = $.fn.zTree.getZTreeObj("departmentTree");
								nodeList = treeObj.getCheckedNodes(true),
								idList = [];
								nodeObj = {};
								for(var i=0; i<nodeList.length; i++) {
									nodeObj = nodeList[i];
									idList.push(nodeObj.id);
								}
								if(!idList.length) {
									util.alert("最少勾选一个部门");
									return;
								}
								loginInfo["loginInfo.department_id"] = ","+idList.join(",")+",";
								
								util.call("/employInfoData/employViewSave", loginInfo, function(returnMsg) {
									util.refreshPage(dataMap);
									util.closeModal(dataMap);
									util.alert(returnMsg["returnMsg"]);
								});
							}
						}
					}
				}
			}
		}
	},
	function(data) {
		var tableHTML = [],
			obj = {},
			employInfoList = data.list,
			search = data["search"],
			employInfoUpdate = data["employInfoUpdate"],
			employInfoDelete = data["employInfoDelete"],
			employOpenAccount = data["employOpenAccount"],
			employEditAccount = data["employEditAccount"];
		for (var i = 0; i < employInfoList.length; i++) {
			obj = employInfoList[i];
			tableHTML.push('<tr>');
			tableHTML.push('	<td>', (i + 1), '</td>');
			tableHTML.push('	<td><a href="javascript:void(0);" onclick="$(\'#powerPidSearch\').val(', obj.id, ');util.execute(\'', search, '\');">', obj.employ_name, '</a></td>');
			tableHTML.push('	<td>', obj.employ_sex==1?"男" : "女", '</td>');
			tableHTML.push('	<td>', obj.employ_phone , '</td>');
			tableHTML.push('	<td>');
			tableHTML.push('		<a href="javascript:void(0);" onclick="util.execute(\'',employInfoUpdate,'\', {id : ',obj.id,', title: \'员工修改\'});">修改</a>');
			tableHTML.push('		<a href="javascript:void(0);" onclick="util.execute(\'',employInfoDelete,'\', {id : ',obj.id,', pageHtml: \'确定要删除【',obj.employ_name,'】吗？\'});">删除</a>');
			if(obj.login_name==null){
				tableHTML.push('		<a href="javascript:void(0);" onclick="util.execute(\'',employEditAccount,'\', {\'employInfo.id\' : ',obj.id,', \'employInfo.employ_name\' : \'',obj.employ_name,'\', title: \'开通账号\'});">开通账号</a>');
			}else{
				tableHTML.push('		<a href="javascript:void(0);" onclick="util.execute(\'',employEditAccount,'\', {\'employInfo.id\' : ',obj.id,', title: \'设置账号\'});">设置账号</a>');
			}
			tableHTML.push('	</td>');
			tableHTML.push('</tr>');
		}
		$("#employInfoTable tbody").html(tableHTML.join(""));
	});
		
</script>
#end