#@layout()
#define main()
<div class="row">
	<div class="col-md-12">
		<div class="panel panel-visible">
		
			<!-- <div class="panel-heading">
				<ol class="breadcrumb" id="projectInfo_menu"> </ol>
			</div> -->
			<div class="panel-body pn">
				<div class="dataTables_wrapper form-inline dt-bootstrap no-footer">			
					<div class="dt-panelmenu clearfix">
						<div class="form-horizontal">
							<div class="form-group">
								<div class="col-md">
									<label class="control-label">合同有效期:</label>
								</div>
								<div class="col-md">
									<input class="form-control width100" id="contract_startTime" type="text" />
								</div>
								<div class="col-md line_height39">-</div>
								<div class="col-md">
									<input class="form-control width100" id="contract_endTime" type="text" />
								</div>
								<div class="col-md">
									<label class="control-label">合同类型：</label>
								</div>
								<div class="col-md">
				         			<select class="form-control" id="contractTypeSearch" style="width: 100px;">
				         				<option value="">全部</option>
				         				#for(contractType:contractTypeList)
				         				<option value="#(contractType.id)">#(contractType.dictionary_name)</option>
				         				#end
									</select>
								</div>
								<div class="col-md">
									<label class="control-label">合同编号:</label>
								</div>
								<div class="col-md">
									<input class="form-control" id="contractNumberSearch" type="text" style="width: 108px;" />
								</div>
							</div>
						</div>
						<div class="form-horizontal">
							<div class="form-group">
								<div class="col-md">
									<label class="control-label">试用有效期:</label>
								</div>
								<div class="col-md">
									<input class="form-control width100" id="trial_startTime" type="text" name="startTime" />
								</div>
								<div class="col-md line_height39">-</div>
								<div class="col-md">
									<input class="form-control width100" id="trial_endTime" type="text" name="endTime" />
								</div>
								<div class="col-md">
									<label class="control-label">合同状态：</label>
								</div>
								<div class="col-md">
				         			<select class="form-control" id="contractStateSearch" style="width: 100px;">
				         				<option value="">全部</option>
										<option value="1">试用期</option>
										<option value="2">已转正</option>
										<option value="3">已解除</option>
									</select>
								</div>
								<div class="col-md">
									<label class="control-label">员工姓名:</label>
								</div>
								<div class="col-md">
									<input class="form-control" id="contractEmployNameSearch" type="text" style="width: 108px;" />
								</div>
								<div class="col-md">
									<input class="btn btn-primary btn-gradient dark" type="button" value="搜索" id="personnelContractSearch" />
									<input class="btn btn-primary btn-gradient dark" type="button" value="重置" id="personnelContractReset" />
									<button type="button" class="btn btn-primary btn-gradient dark" id="personnelContractAdd">合同添加</button>
								</div>
							</div>
						</div>
					
					</div>
					<table class="table table-striped table-hover dataTable no-footer" id="personnelContractTable">
						<thead>
							<tr>
								<th class="sorting_disabled">&nbsp;</th>
								<th class="sorting_disabled">&nbsp;</th>
								<th class="sorting_asc">员工姓名</th>
								<th class="sorting">合同编号</th>
								<th class="sorting">合同类型</th>
								<th class="sorting">合同状态</th>
								<th>合同有效期</th>
								<th class="sorting_disabled width200">操作</th>
							</tr>
						</thead>
						<tbody> </tbody>
					</table>
					<div class="dt-panelfooter clearfix">
						<div class="dataTables_info" id="datatable2_info" role="status"
							aria-live="polite">Showing 1 to 5 of 13 entries</div>
						<div class="dataTables_paginate paging_simple_numbers"
							id="personnelContractpage">
							<ul class="pagination">
								<li class="paginate_button active" aria-controls="datatable2"
									tabindex="0"><a href="#">1</a></li>
								<li class="paginate_button " aria-controls="datatable2" tabindex="0"><a
									href="#">2</a></li>
								<li class="paginate_button " aria-controls="datatable2" tabindex="0"><a
									href="#">3</a></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
			
		</div>
	</div>
</div>


<script type="text/javascript">
	util.initDateRange("#contract_startTime","#contract_endTime", "", "", true);
	util.initDateRange("#trial_startTime","#trial_endTime", "", "", true);
	util.initPage("/personnelContractData/personnelContractList", {
		paginate:{
			paginateId:"#personnelContractpage",
			pageNumber:1,
			pageSize:10
		},
		sort : {
			"id" : "asc"
		},
 		search : {
			bind : {
				searchId : "#personnelContractSearch",
				resetId : "#personnelContractReset"
			},
			column : {
				"contract_start" : ["betweenDate" , "#contract_startTime,#contract_endTime"],
				"trial_start" : ["betweenDate","#trial_startTime,#trial_endTime"],
				"trial_end" : ["betweenDate","#trial_startTime,#trial_endTime"],
 				"contract_end" : ["betweenDate","#contract_startTime,#contract_endTime"],
				"contract_number" : ["like","#contractNumberSearch"],
				"contract_type" : ["=","#contractTypeSearch"],
				"personnel_contract_employ_name" : ["like","#contractEmployNameSearch"],
				"contract_state" : ["=","#contractStateSearch"]				
			}
		},
		modal : {
			"personnelContractUpdate" : {
				bind: {
					"#personnelContractAdd": {
						title: "合同添加"
					}
				},
				pageUrl : "/personnelContractPage/personnelContractEdit",
				title : "合同修改",
				width : 800,
				button : {
					"submit" : {
						name : "确定",
						className : "btn-primary",
						click : function(dataMap) {
							if($('#personnelContractForm').validationEngine('validate')) {
								var personnelContract = util.getModal(dataMap);
									personnelContract["personnelContract.employ_id"] = $("#employ_id").attr("_value");								
									if($("#employ_id").val()==""){
										util.alert("请选择员工姓名");
										return;
									}
									if($("#contract_start").val()==""){
										util.alert("请选择合同签订日期");
										return;
									}
									if($("#trial_start").val()==""){
										util.alert("请选择试用生效日期");
										return;
									}
									if(($("#contract_start").val().replace(/-/g,"\/")>$("#trial_start").val().replace(/-/g,"\/"))||($("#contract_start").val().replace(/-/g,"\/")>$("#trial_end").val().replace(/-/g,"\/"))){
										util.alert("合同签订日期必须在试用生效日期和试用到期日期之前");
										return;
									}
									if(($("#contract_end").val().replace(/-/g,"\/")<$("#trial_start").val().replace(/-/g,"\/"))||($("#contract_end").val().replace(/-/g,"\/")<$("#trial_end").val().replace(/-/g,"\/"))){
										util.alert("合同到期日期必须在试用生效日期和试用到期日期之后");
										return;
									}
								util.call("/personnelContractData/personnelContractSave", personnelContract, function(returnMsg) {
									util.refreshPage(dataMap);
									util.closeModal(dataMap);
									util.alert(returnMsg["returnMsg"]);
								});
							}
						}
					}
				}
			},
			"personnelContractDelete" : {
				button : {
					"submit" : {
						name : "确定",
						className : "btn-primary",
						click : function(dataMap) {
							util.call("/personnelContractData/personnelContractDelete", {
								"id": dataMap["id"]+""
							}, function(returnMsg) {
								util.refreshPage(dataMap);
								util.closeModal(dataMap);
								util.alert(returnMsg["returnMsg"]);
							});
						}
					}
				}
			}
		}
	},function(data) {
		var tableHTML = [],
		obj = {},
		personnelContractList = data.list,
		personnelContractUpdate = data["personnelContractUpdate"],
		personnelContractDelete = data["personnelContractDelete"];
		for (var i = 0; i < personnelContractList.length; i++) {
			obj = personnelContractList[i];
			tableHTML.push('<tr>');
			tableHTML.push('<td></td>');
			tableHTML.push('	<td>', (i + 1), '</td>');
			tableHTML.push('	<td>', obj.personnel_contract_employ_name, '</td>');
			tableHTML.push('	<td>', obj.contract_number, '</td>');
			tableHTML.push('	<td>', obj.personnel_contract_type, '</td>');
			tableHTML.push('	<td>', obj.contract_state==1?"试用期":obj.contract_state==2?"已转正":"已解除", '</td>');
			tableHTML.push('	<td>', obj.contract_start, '到', obj.contract_end ,'</td>');
			tableHTML.push('	<td>');
			tableHTML.push('		<a href="javascript:void(0);" onclick="util.execute(\'',personnelContractUpdate,'\', {id : ',obj.id,', title: \'修改合同\'});">修改</a>');
			tableHTML.push('		<a href="javascript:void(0);" onclick="util.execute(\'',personnelContractDelete,'\', {id : ',obj.id,', pageHtml: \'确定要删除合同编号为【',obj.contract_number,'】的合同吗？\'});">删除</a>');
			tableHTML.push('	</td>');
			tableHTML.push('</tr>');
		}
		$("#personnelContractTable tbody").html(tableHTML.join(""));
	});
</script>
#end